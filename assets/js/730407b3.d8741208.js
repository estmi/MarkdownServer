"use strict";(self.webpackChunkmarkdown_website=self.webpackChunkmarkdown_website||[]).push([[6715],{7124:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>t,contentTitle:()=>o,default:()=>d,frontMatter:()=>p,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"gisce/procediments/import_sips_old","title":"Importar SIPS","description":"Descarregar SIPS","source":"@site/docs/gisce/procediments/import_sips_old.md","sourceDirName":"gisce/procediments","slug":"/gisce/procediments/import_sips_old","permalink":"/docs/gisce/procediments/import_sips_old","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Importar SIPS (SIPS_Importer)","permalink":"/docs/gisce/procediments/import_sips"},"next":{"title":"Install Languages","permalink":"/docs/gisce/procediments/install_language"}}');var i=r(4848),a=r(8453);const p={},o="Importar SIPS",t={},l=[{value:"Descarregar SIPS",id:"descarregar-sips",level:2},{value:"Preparant la importacio",id:"preparant-la-importacio",level:2},{value:"Enviar els sips al servidor",id:"enviar-els-sips-al-servidor",level:3},{value:"Executarem un script per poder descomprimir els zips",id:"executarem-un-script-per-poder-descomprimir-els-zips",level:3}];function c(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"importar-sips",children:"Importar SIPS"})}),"\n",(0,i.jsx)(s.h2,{id:"descarregar-sips",children:"Descarregar SIPS"}),"\n",(0,i.jsx)(s.p,{children:"El client ens envia els zips amb tots els SIPS, els descarregarem i guardarem dins d'una carpeta."}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"/gisce/procediments/import_sips/image.png",alt:"zips_en_carpeta"})}),"\n",(0,i.jsx)(s.p,{children:"Seran un total de 8 arxius, 4 de PS i 4 de CONSUMOS i son els seguents: ELECTRICIDAD_baleares, ELECTRICIDAD_canarias, ELECTRICIDAD_peninsular i GAS_nacional."}),"\n",(0,i.jsx)(s.p,{children:"Depen del client potser nomes hi haura ELECTRICIDAD_peninsular."}),"\n",(0,i.jsx)(s.h2,{id:"preparant-la-importacio",children:"Preparant la importacio"}),"\n",(0,i.jsx)(s.h3,{id:"enviar-els-sips-al-servidor",children:"Enviar els sips al servidor"}),"\n",(0,i.jsxs)(s.p,{children:["Utilitzarem la comanda ",(0,i.jsx)(s.code,{children:"scp"})," per poder enviar tots els zips al servidor:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ShellSession",children:"localhost:~$ scp *.zip {server}:/home/gisce/sips\n202411_SIPS2_CONSUMOS_ELECTRICIDAD_baleares.zip                                                             100%  509MB  59.1MB/s   00:08    \n202411_SIPS2_CONSUMOS_ELECTRICIDAD_canarias.zip                                                             100%  831MB  60.1MB/s   00:13\n202411_SIPS2_CONSUMOS_ELECTRICIDAD_peninsular.zip                                                           100%   18GB  59.4MB/s   05:12    \n202411_SIPS2_CONSUMOS_GAS_nacional.zip                                                                      100% 1191MB  60.5MB/s   00:19    \n202411_SIPS2_PS_ELECTRICIDAD_baleares.zip                                                                   100%   31MB  58.4MB/s   00:00    \n202411_SIPS2_PS_ELECTRICIDAD_canarias.zip                                                                   100%   48MB  59.4MB/s   00:00    \n202411_SIPS2_PS_ELECTRICIDAD_peninsular.zip                                                                 100%  934MB  60.4MB/s   00:15    \n202411_SIPS2_PS_GAS_nacional.zip                                                                            100%  438MB  59.5MB/s   00:07    \n"})}),"\n",(0,i.jsx)(s.p,{children:"Mourem els zips a la maquina de mongo:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ShellSession",children:"localhost:~$ scp *.zip {server}:/home/gisce/sips\n202411_SIPS2_CONSUMOS_ELECTRICIDAD_baleares.zip                                                             100%  509MB  59.1MB/s   00:08    \n202411_SIPS2_CONSUMOS_ELECTRICIDAD_canarias.zip                                                             100%  831MB  60.1MB/s   00:13\n202411_SIPS2_CONSUMOS_ELECTRICIDAD_peninsular.zip                                                           100%   18GB  59.4MB/s   05:12    \n202411_SIPS2_CONSUMOS_GAS_nacional.zip                                                                      100% 1191MB  60.5MB/s   00:19    \n202411_SIPS2_PS_ELECTRICIDAD_baleares.zip                                                                   100%   31MB  58.4MB/s   00:00    \n202411_SIPS2_PS_ELECTRICIDAD_canarias.zip                                                                   100%   48MB  59.4MB/s   00:00    \n202411_SIPS2_PS_ELECTRICIDAD_peninsular.zip                                                                 100%  934MB  60.4MB/s   00:15    \n202411_SIPS2_PS_GAS_nacional.zip                                                                            100%  438MB  59.5MB/s   00:07    \n"})}),"\n",(0,i.jsx)(s.h3,{id:"executarem-un-script-per-poder-descomprimir-els-zips",children:"Executarem un script per poder descomprimir els zips"}),"\n",(0,i.jsxs)(s.p,{children:["Executarem el seguent script desde la carpeta ",(0,i.jsx)(s.code,{children:"/home/erp/var/import_sips"})," que ens descomprimira els zips i encuara la carrega de sips. Quan creem l'script de python, molt important s'ha de configurar les variables URL,DB,USER,PWD."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"#! /bin/bash\n\nmkdir 'splitted'\nmkdir 'splitted/done'\n\nfor file in *.zip\ndo\n        filename=$(echo $file | rev | cut -f 2- -d '.' | rev)\n        echo \"${filename}\"\n        zcat $file | split --additional-suffix=.csv -l 1000000 - \"splitted/${filename}_splitted\"\ndone\n\npython queue_sips.py\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"queue_sips.py"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"# -*- encoding: utf-8 -*-\nfrom erppeek import Client\nfrom os import environ\n\nfrom pathlib import Path\n\nserver = # url erp\ndb = # nom database\nuser = # usuari a utilitzar\npassword = # password\nfolder_path = str(Path().resolve())+'/splitted'\n\nif not server or not db or not user or not password or not folder_path:\n   raise Exception('Falta alguna variable, URL o DB o USER o PASSWORD o PATH')\n\nc = Client(server, db, user=user, password=password)\n\nc.GiscedataCnmcComerSipsImporter.process_dir(folder_path)\n"})})]})}function d(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,s,r)=>{r.d(s,{R:()=>p,x:()=>o});var n=r(6540);const i={},a=n.createContext(i);function p(e){const s=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:p(e.components),n.createElement(a.Provider,{value:s},e.children)}}}]);